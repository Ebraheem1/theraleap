\chapter{Introduction}
\section{Problem description}
In 2016, approximately 60.000 german residents have been hospitalized due to hand or wrist injuries \cite{DeStatisHandInjuries}. The initial treatment of such injuries is often followed by a lengthy recovery phase in which ergotherapeutic treatment occurs in order to further aid recovery. As ergo therapy sessions are usually held in one-on-one sessions, this results in a significant time and resource both by the patient and the treating clinic. Additionally, the sessions themselves are often described by patients as boring and unmotivating by their repetitive nature.

Ergo therapists of the Katharinenhospital Stuttgart are currently researching alternative treatment methods that could be an improvement to all three of these fundamental problems. The aim of the research is to introduce various gamification aspects to the recovery sessions. The patients should be enabled to do repetitive parts of the recovery exercises at home by means of successfully executing them while controlling video games. This methodology of executing prevention and rehabilitation measures is an active and well known field of research commonly referred to as Exergames\cite{RehaCareExergames}. In a more general sense, games that are designed with a second primary purpose (apart from entertainment) are referred to as serious games \cite{SeriousGamesBook}. 

\section{Project Scope}
The scope of this student research project is to design and provide implementations for a software solution acting as an underlying framework on which the Exergames can be executed. The framework should be capable of meeting the determined requirements as outlined in section \ref{sec:reqanalysis} either directly through the provided implementation, or, if some requirements cannot be fulfilled with the reference implementation, by way of easy extensibility. The framework should also contain a user facing component where relevant measurements and game configurations can be made and from which the games are executed. Additionally, the framework should contain various tools that will make it easier for future developers to develop and debug subcomponents.

\section{Requirements Analysis}
\label{sec:reqanalysis}
Outsourcing recovery exercises into a space where no direct therapeutic supervision is available generates a series of challenges that have to be identified and overcome before successfully integrating Exergames in the recovery sessions. 

\subsection{Functional Requirements}
In a software development context, the challenges a system has to solve in order to become useful to the stakeholders are referred to as functional requirements.  The most notable functional requirements are outlined as follows.

\subsubsection{Domain Virtualization}
In order for Exergames to fundamentally function, they require an accurate, real-time virtualized representation of the problem domain. For example, in order to develop Exergames for treating hand injuries, a virtual representation of the hand must be available.

\subsubsection{Exercise Classification}
\label{sec:exercise-classification}
The most important capability of an Exergame is to correctly classify whether a recovery exercise has been executed. In the domain of hand and wrist injury recovery, a recovery exercise may for example be the spreading of the thumb, where the remaining fingers of the hand remain closed. Other examples for recovery exercises have been outlined by \cite{StudiArbeitVolzBaumotte}. The result of the exercise classification can then be used as a gameplay element in the Exergame. For example, if a thumb spread exercise as described above has been executed well enough, a \emph{Space Invaders-like} Exergame could trigger the space ship to shoot.

\subsubsection{Patient Adaptibility}
One-on-one therapy sessions in ergo therapy are required because of the large variety of different hand injuries, each requiring a different set of recovery exercises. Additionally, the classification logic (see \ref{sec:exercise-classification}) for the recovery exercises themselves have to be adaptable to how far the patient has progressed so far in recovery. For example, if the patient is progressing well in recovery, the relevant exercise has to be increased in difficulty in order for the treatment to remain effective.

\subsubsection{Monitorability}
\label{sec:req:monitorability}
The ergo therapist has to be able to view monitoring information related to the patients playing activity. Most fundamentally, the therapist should be able to view the number of times and total duration of Exergames played in order to verify if the agreed upon exercise volume has been completed. Additionally, specific information that aid the ergo therapist in assessing the recovery progress of the patient should be available. If the therapist determines that the current exercise has to be adapted in some way, or for exchanging other kinds of information with the patient, such as providing hints or agreeing on the next physical appointment date, this should be possible through an integrated messaging platform. Furthermore, the monitoring information should be able accessible through a web-based interface.

\subsubsection{Gameplay and Frontend}
\label{sec:gameplay}
Finally, the system should provide a frontend component, from which the actual games are executed and configured, and where display components relevant for resolving other software requirements can be found.

\subsection{Non-Functional Requirements}
In addition to the functional requirements, the following \glspl{NFR} have to be considered while designing and implementing the system. \glspl{NFR} are global requirements that are not directly related to function, but refer to the development or operational costs of the system, such as performance, reliability, and maintainability \cite{chung2012non}.

\subsubsection{Modularization}
On a technical level, the program logic responsible for classifying if an exercise has been completed (see \ref{sec:exercise-classification}) should be separated from the actual Exergames logic (see \ref{sec:gameplay}). This would pose the advantage of introducing a modular aspect to the system, as both exercise classifiers and games could be exchanged, both keeping the patients engaged in the platform by allowing them to train their assigned exercise using a variety of games, and greatly simplifying the work of future developers, as they will be enabled to develop games for the platform without any prior knowledge of exercise classification, and vice versa.

\subsubsection{Performance}
Performance is a critical \gls{NFR} for the system. All data coming from the device providing the relevant domain virtualization has to be ingested, preprocessed, and classified in real time. If this is not the case, the patient will experience a significant lag between the performed exercise and the feedback of the Exergames, quickly resulting in frustration. Additionally, the execution of the Exergames themselves should be performant enough so that the gameplay experience isn't negatively obstructed. 

\subsubsection{Ease of deployment}
The system should ultimately be primarily executed on a patient provided device. As such, deployment of the application should be easy, and robust with respect to a multitude of possible, previously unknown target environments.

\subsubsection{Extensibility}
As the system is acting primarily as an underlying framework on which other developers should build upon in the future, it should be written in a way that allows for easy extensibility. It should especially be written in a computer programming language that is well known to the potential target developer audience, so minimum prior knowledge is required before starting development with the project. Additionally, the framework should be future proof: it should be simple to exchange subcomponents with more modern equivalents in the future. For example, it should be simple to add support for more modern hardware devices providing domain virtualization, or more modern graphics libraries for developing the Exergames in the future.

\section{Solution Design}
\subsection{Available Alternatives}
Based on the requirements, which have been gathered and derived on various in person meetings with the stakeholding therapists, multiple technologies for implementing the system seem feasible. The alternatives considered at the beginning of this project are outlined as follows.

\subsubsection{Fully featured Web Application}
\label{sec:alt:fully-featured-web-app}
One technological possibility would be to implement the core system framework as a fully featured Web Application. All requirements would be implemented using web technologies. Most notably, data ingestion, preprocessing, classification, and monitoring would have to be accomplished entirely in the context of a web browser. The system would be self-sufficient in this configuration, without reliance on any external systems, though an external server component for sending the monitoring information is conceivable (see requirement \ref{sec:req:monitorability}).

This configuration is very favorable in terms of deployment and extensibility, as every component is consistently written in Javascript, the standardized programming language of the web. Likewise, as functionality is not distributed over multiple systems, the deployment of the systems only requires a web browser\footnote{The installation of relevant hardware device drivers on the target device is also required for the system to function, but as the same is true for all other alternatives, this is not considered under the ease of deployment aspect.}.

However, for this configuration to be feasible, it is required that the domain virtualization device contains an API to the Web Browser. Also, the Javascript programming language is sometimes critizied for its relatively poor performance when compared to programming languages with compilers capable of producing native code. This is owed in large parts to the dynamically typed and interpreted nature of the language. Some benchmarks show that Javascript is up to ten times slower in terms of runtime performance compared to C++ when running computationally expensive tasks \cite{BenchmarksGame}. The question of whether Javascript is performant enough to tackle the task at hand has to be clarified before this alternative can be considered feasible.
\subsubsection{Web Application with local server component}
\label{sec:alt:thin-web-app}
The two main disadvantages of the Fully featured Web Application ,the need for a Web API of the virtualization device and the performance considerations, could be mitigated by moving the computationally expensive logic in a locally running server component, and interfacing the two components by using an asynchronous communication specifications such as WebSockets or XmlHttpRequest. As the code running in the server component is running with Operating System permissions, it could directly interface with the hardware device. Additionally, all logic concerned with working with the virtualization device data could be implemented in native code, resulting in high performance.

This approach in turn poses the disadvantage that a lot of additional complexity is introduced into the system. The system would no longer be implemented in a single programming language. Additionally, the system would no longer be easy to deploy, as compiled binary packages would have to be provided and thoroughly tested for each desired target Operating System.
\subsubsection{Web Application with remote server component (backend)}
\label{sec:alt:thin-remote-web-app}
Following up on the design outlined in section \ref{sec:alt:thin-web-app}, the system could also be designed with a remote server component instead of a locally running server. This would have the advantage of all device data being available
at one centralized location, where very elaborate analytics could be performed. As all alternatives outlined in this section will eventually require a backend component for accumulating monitoring information for the therapist to view and inspect, this approach initially seems to reduce complexity.

However, the virtualized domain data would again have to be ingested by the Web Application, in a similar fashion to the alternative outlined in \ref{sec:alt:fully-featured-web-app}, as no local application is available to handle the connection to the hardware device. Furthermore, all virtualization device data would have to be sent over the network connection of the end device, potentially resulting in high latency, and possibly full system outage if the end device fails to establish an internet connection.
\subsubsection{Desktop Application}
\label{sec:alt:desktop-app}
Finally, the system could be designed without relying on Web technologies altogether, and be instead implemented as a traditional Desktop Application.

\begin{table}[h]\footnotesize
\caption{Comparison of implementation alternatives based on estimated requirement fulfillment}
\label{alt:table-requirement-comparison}
\renewcommand{\arraystretch}{1.3}
\begin{tabular}{l|ccccc}
    &
    \rot{Functional Reqs.} &
    \rot{Modularization} &
    \rot{Performance} &
    \rot{Deployment} &
    \rot{Extensibility}
        \\ \hline
    Web fat client (\ref{sec:alt:fully-featured-web-app})     & X & X & ? & X & X \\ 
    Web thin client (\ref{sec:alt:thin-web-app})   & X & X &   &   & X \\ 
    Web local client (\ref{sec:alt:thin-remote-web-app}) & X & X & X &   &   \\
    Desktop App (\ref{sec:alt:desktop-app}) &   & X & X & X &  \\ \hline
\end{tabular}
\normalsize
\subsection{Elected Alternative}
Table \ref{alt:table-requirement-comparison} gives an overview over the likely requirement fulfillment of the discussed implementation alternatives.

\end{table}

% fully featured web platform, because modern web technologies allow it, GUI Application does not fit the requirements, and separating main work into server thread is, while potentially more performant, both potentially insecure and unnecessarily complex.