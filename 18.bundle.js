(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{131:function(e,t,r){(e.exports=r(23)(!1)).push([e.i,".md-card[data-v-662f7e1f]{margin-bottom:20px;max-width:800px}.container[data-v-662f7e1f],.header-flex-container[data-v-662f7e1f]{display:flex}.container .form[data-v-662f7e1f]{flex:2}.container .preview[data-v-662f7e1f]{flex:3;height:250px;width:450px}",""])},132:function(e,t,r){var i=r(131);"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);(0,r(22).default)("95bde912",i,!0,{})},172:function(e,t,r){"use strict";r.r(t);var i=r(1),s=r(6),a=r(27),o=r(25),d=r(203),c=r(13),n=r(198);let l=class extends i.default{constructor(){super(...arguments),this.recordInProgress=!1,this.bufferFullPercentage=0,this.showRestore=!1,this.persistedRecordings=0,this.restoreInProgress=!1,this.buffer=[],this.currentBufferSize=0,this.bufferMaxSize=2e7}createNewEmptyRecording(){return this.clearLocalState(),Object(o.a)(this.$store,{recording:{name:`Recording #${this.totalRecordings+1}`,id:this.totalRecordings+1,recording:[],created:!1,creationDate:Date.now(),size:0,duration:0},persistor:this.persistor})}async created(){if(this.persistor&&0===this.totalRecordings){const e=await this.persistor.count();e>0&&(this.persistedRecordings=e,this.showRestore=!0)}}async restoreRecordings(){if(this.persistor){this.restoreInProgress=!0,(await this.persistor.getAll()).forEach(e=>{Object(o.a)(this.$store,{recording:e,persistor:void 0})}),this.restoreInProgress=!1,this.showRestore=!1}}startRecord(e){this.recordInProgress=!0,this.deviceTrackingData&&(this.deviceSubscription=this.deviceTrackingData.subscribe(t=>{const r=this.updateBuffer(t,Date.now());this.update(e,{size:r,duration:this.getBufferDuration()}),r>this.bufferMaxSize&&this.stopRecord()}))}downloadRecord(e){const t=this.recordings[e],r=new Blob([JSON.stringify(t)],{type:"octet/stream"}),i=URL.createObjectURL(r),s=document.createElement("a");s.download=`thera-rec--${t.name.replace(/\s/g,"-")}.json`,s.href=i,s.target="_blank",s.setAttribute("display","none;"),document.body.appendChild(s),s.click()}clearLocalState(){this.buffer=[],this.currentBufferSize=0,this.bufferFullPercentage=0}updateBuffer(e,t){return this.currentBufferSize+=Object(a.sizeof)(e.data),this.bufferFullPercentage=this.currentBufferSize/this.bufferMaxSize*100,this.buffer.push({data:{data:e.data},time:t}),this.currentBufferSize}getBufferDuration(){return this.buffer&&this.buffer.length>=2?this.buffer[this.buffer.length-1].time-this.buffer[0].time:void 0}stopRecord(){this.deviceSubscription&&this.deviceSubscription.unsubscribe(),this.recordInProgress=!1}saveRecord(e){this.stopRecord(),Object(o.n)(this.$store,{id:e,update:{created:!0,recording:this.buffer},persistor:this.persistor}),this.clearLocalState()}discardRecord(e){this.stopRecord(),this.clearLocalState(),Object(o.c)(this.$store,{id:e,persistor:this.persistor})}toggleActivated(e){this.activatedId==e?Object(o.l)(this.$store,-1):Object(o.l)(this.$store,e),this.deviceFacade.notifyStreamSourceShouldUpdate(this.$store)}update(e,t){Object(o.n)(this.$store,{id:e,update:t})}get persistor(){return Object(n.a)(this.$store)}get recordings(){return Object(o.g)(this.$store)}get recordingsSortedDescending(){return Object(o.h)(this.$store)}get recordInCreation(){return Object(o.j)(this.$store)}get activatedId(){return Object(o.d)(this.$store)}get totalRecordings(){return Object(o.i)(this.$store)}get connectionHealthy(){return Object(c.b)(this.$store)}get deviceFacade(){return Object(c.e)(this.$store)}get deviceTrackingData(){return this.deviceFacade.getDeviceTrackingData()}};var u=l=function(e,t,r,i){var s,a=arguments.length,o=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var d=e.length-1;d>=0;d--)(s=e[d])&&(o=(a<3?s(o):a>3?s(t,r,o):s(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o}([Object(s.a)({components:{GraphicalHandLogger:d.a},filters:{formatSize:a.format}})],l),h=r(10);var f=function(e){r(132)},m=Object(h.a)(u,function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("section",{staticClass:"device-recorder"},[e.restoreInProgress?r("div",[r("span",[e._v("Restoring data from persistence layer...")]),e._v(" "),r("md-progress-bar",{attrs:{"md-mode":"indeterminate"}})],1):e._e(),e._v(" "),0==e.totalRecordings?r("md-empty-state",{attrs:{"md-icon":"mic","md-label":"Create your first recording","md-description":"Create recordings of raw hand tracking data in order to develop and test games for the therapy platform without the physical need of a hand tracking device."}},[r("md-button",{staticClass:"md-primary md-raised",on:{click:e.createNewEmptyRecording}},[e._v("Create first recording")])],1):r("main",[r("md-button",{staticClass:"md-icon-button md-primary",attrs:{disabled:e.recordInCreation},on:{click:e.createNewEmptyRecording}},[r("md-icon",[e._v("add")])],1),e._v(" "),e._l(e.recordingsSortedDescending,function(t){return r("md-card",{key:t.id,attrs:{"md-with-hover":""}},[r("md-card-header",{staticClass:"header-flex-container"},[r("section",{staticClass:"header-left"},[r("div",{staticClass:"md-title"},[e._v(e._s(t.name))]),e._v(" "),r("div",{staticClass:"md-subhead"},[e._v("Created "+e._s(t.creationDate))])]),e._v(" "),r("section",{staticClass:"header-right"},[r("md-switch",{attrs:{model:e.activatedId==t.id,disabled:!t.created},on:{change:function(r){e.toggleActivated(t.id)}}})],1)]),e._v(" "),t.created?r("md-card-content"):r("md-card-content",[r("div",{staticClass:"container"},[r("div",{staticClass:"form"},[r("md-field",[r("label",[e._v("Name")]),e._v(" "),r("md-input",{attrs:{value:t.name},on:{input:function(r){e.update(t.id,{name:r})}}})],1),e._v(" "),r("md-field",[r("label",[e._v("Size")]),e._v(" "),r("md-input",{attrs:{value:e._f("formatSize")(t.size),readonly:""}})],1),e._v(" "),r("md-field",[r("label",[e._v("Duration (milliseconds)")]),e._v(" "),r("md-input",{attrs:{readonly:"",value:t.duration}})],1),e._v(" "),r("md-progress-bar",{attrs:{"md-mode":"determinate","md-value":e.bufferFullPercentage}}),e._v(" "),r("md-button",{attrs:{disabled:!e.connectionHealthy||e.recordInProgress},on:{click:function(r){e.startRecord(t.id)}}},[e._v("Record")]),e._v(" "),r("md-button",{attrs:{disabled:!e.recordInProgress},on:{click:e.stopRecord}},[e._v("Stop")])],1),e._v(" "),r("div",{staticClass:"preview"},[r("graphical-hand-logger",{attrs:{source:e.deviceTrackingData,transparent:!0}})],1)])]),e._v(" "),r("md-card-actions",[t.created?e._e():r("md-button",{staticClass:"md-raised md-primary",attrs:{disabled:0===e.buffer.length},on:{click:function(r){e.saveRecord(t.id)}}},[e._v("Save")]),e._v(" "),t.created?e._e():r("md-button",{staticClass:"md-accent md-raised",on:{click:function(r){e.discardRecord(t.id)}}},[e._v("Discard")]),e._v(" "),t.created?r("md-button",{on:{click:function(r){e.downloadRecord(t.id)}}},[e._v("Download")]):e._e(),e._v(" "),t.created?r("md-button",{staticClass:"md-accent",on:{click:function(r){e.discardRecord(t.id)}}},[e._v("Delete")]):e._e()],1)],1)})],2),e._v(" "),r("md-snackbar",{attrs:{"md-position":"center","md-duration":1/0,"md-active":e.showRestore,"md-persistent":""},on:{"update:mdActive":function(t){e.showRestore=t}}},[r("span",[e._v("The Persistence Provider is holding "+e._s(e.persistedRecordings)+" recordings.")]),e._v(" "),r("md-button",{staticClass:"md-primary md-raised",on:{click:e.restoreRecordings}},[e._v("Restore")]),e._v(" "),r("md-button",{staticClass:"md-raised",on:{click:function(t){e.showRestore=!1}}},[e._v("Dismiss")])],1)],1)},[],!1,f,"data-v-662f7e1f",null);t.default=m.exports}}]);